class PushpageCollection{constructor(e){this.pushpages=e,e.forEach((e,t)=>{e.setParentCollection(this)}),document.addEventListener("DOMContentLoaded",e=>{this.bindClickEvents(),this.pageCall()}),window.addEventListener("popstate",e=>{this.pageCall()})}get(e){return isNaN(e)?this.pushpages.find(t=>t.getUrlParamName()===e):this.pushpages[e]}getLength(){return this.pushpages.length}add(e){this.pushpages?this.pushpages.push(e):this.pushpages=[e],e.setParentCollection(this)}remove(e){if(this.pushpages){const t=this.pushpages.findIndex(t=>t.getUrlParamName()===e.getUrlParamName());this.pushpages.splice(t,1)}}getCollection(){return this.pushpages}isEmpty(){return!this.pushpages||0===this.pushpages.length}bindClickEvents(){this.pushpages.forEach(e=>{let t=document.querySelectorAll('a[href^="?'+e.getUrlParamName()+'"]');t.forEach(t=>{t.onclick=(t=>{t.preventDefault(),t.stopPropagation();let i=PushpageHelper.getUrlParameterValue(e.getUrlParamName(),t.target.href);e.open({value:i})})})})}pageCall(){let e=this.getCalledPages(),t=this.pushpages.filter(t=>-1===e.indexOf(t)&&t.isActive());e.forEach((e,t)=>{e.open({skipUrlParam:!0,index:t})}),t.forEach(e=>{e.close(!0)})}getCalledPages(){let e=[];return PushpageHelper.getAllUrlParameter().forEach(t=>{let i=this.pushpages.find(e=>e.getUrlParamName()===t);i&&e.push(i)}),e}}class PushpageHelper{static getHTML(e,t){if(!window.XMLHttpRequest)return;let i=new XMLHttpRequest;i.onload=function(){t&&"function"==typeof t&&t(this.responseXML)},i.open("GET",e),i.setRequestHeader("Content-type","text/html"),i.responseType="document",i.send()}static addUrlParam(e,t){let i=window.location.href;if(i.includes(e))return;let s=i.includes("?")?"&":"?",a=i+s+e;return t&&(a+="="+t),this.changeUrl(a)}static removeUrlParameter(e){let t=window.location.href,i=t.split("?");if(i.length>0){let t=i[0].replace("?",""),s="?"+i[1],a=new RegExp("(\\?|&)"+e+"(=)?(.*?(&|$))?"),n=a.exec(s)[0],r=s.search(a),l=s.replace(a,"");"?"==n[0]&&"&"==n.slice(-1)?l="?"+l:"&"==n.slice(-1)&&(l=l.slice(0,r)+"&"+l.slice(r));let o=t+l;return this.changeUrl(o)}return t}static getAllUrlParameter(){let e=window.location.href.split("?");if(e.length>1){let t=e[1].split("&");return t.forEach((e,i)=>{-1!==e.indexOf("=")&&(t[i]=e.slice(0,e.indexOf("=")))}),t}return[]}static changeUrl(e){return history.pushState?window.history.pushState({path:e},"",e):document.location=e,e}static getUrlParameterValue(e,t){return t||(t=decodeURIComponent(window.location.href.substring(1))),(RegExp(e+"=(.+?)(&|$)").exec(t)||[,null])[1]}static addScript(e){let t=document.createElement("script"),i=document.getElementsByTagName("script")[0];t.src=e,i.parentNode.insertBefore(t,i)}static waitFor(e){return new Promise((t,i)=>{if(e)return void t(e);let s=new MutationObserver(function(e){e.forEach(function(e){let i=Array.from(e.addedNodes);for(let e of i)if(e.matches&&e.matches(selector))return s.disconnect(),void t(e)})});s.observe(document.documentElement,{childList:!0,subtree:!0})})}static whichAnimationEvent(){let e,t=document.createElement("fakeelement"),i={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(e in i)if(void 0!==t.style[e])return i[e]}static whichTransitionEvent(){let e,t=document.createElement("fakeelement"),i={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in i)if(void 0!==t.style[e])return i[e]}}class Pushpage{constructor(e){this.Container=e.container,this.className=e.className,this.fileUrl=e.fileUrl,this.urlParamName=e.urlParamName,this.scriptUrl=e.scriptUrl,this.DivElement=void 0,this.active=!1,this.ParentCollection=null}getContainer(){return this.Container}getFileUrl(){return this.fileUrl}getUrlParamName(){return this.urlParamName}getDivElement(){return this.DivElement}isActive(){return this.active}getParentCollection(){return this.ParentCollection}setParentCollection(e){this.ParentCollection=e}getValue(){return PushpageHelper.getUrlParameterValue(this.urlParamName)}getIndex(){return this.ParentCollection.getCollection().findIndex(e=>e===this)}open(e){e||(e={});let t=e.skipUrlParam?e.skipUrlParam:PushpageHelper.addUrlParam(this.urlParamName,e.value);t&&!this.active&&PushpageHelper.getHTML(this.getFileUrl(),t=>{document.createDocumentFragment();let i=this.Container.getElementsByClassName("pushpage");this.DivElement=document.createElement("div"),this.DivElement.setAttribute("name",this.urlParamName),this.DivElement.classList.add("pushpage"),this.className&&this.DivElement.classList.add(this.className),this.Container.classList.add("pushpage-container-active"),i[e.index]?this.Container.insertBefore(this.DivElement,i[e.index]):this.Container.appendChild(this.DivElement),this.DivElement.innerHTML=t.documentElement.innerHTML,this.bindCloseClick(),PushpageHelper.waitFor(this.Container).then(()=>{this.scriptUrl&&(Array.isArray(this.scriptUrl)?this.scriptUrl.forEach(e=>{PushpageHelper.addScript(e)}):PushpageHelper.addScript(this.scriptUrl)),this.ParentCollection.bindClickEvents()}),this.active=!0})}close(e){this.DivElement.classList.add("is-exiting");let t=window.getComputedStyle(this.DivElement);"0s"!==t.animationDuration||"0s"!==t.transitionDuration?(this.DivElement.addEventListener(PushpageHelper.whichAnimationEvent(),e=>{this.destroy(e.target)}),this.DivElement.addEventListener(PushpageHelper.whichTransitionEvent(),e=>{this.destroy(e.target)})):this.destroy(this.DivElement),e||PushpageHelper.removeUrlParameter(this.urlParamName),this.active=!1}destroy(e){e.remove(),this.Container.querySelector(".pushpage")||this.Container.classList.remove("pushpage-container-active")}bindCloseClick(){let e=this.DivElement.getElementsByClassName("pushpage-close");Array.prototype.forEach.call(e,e=>{e.onclick=(e=>{e.preventDefault(),e.stopPropagation(),this.close()})})}}